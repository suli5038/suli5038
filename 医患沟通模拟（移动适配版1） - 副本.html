<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- å…³é”®ï¼šè®¾ç½®è§†å£ï¼Œç¦æ­¢ç”¨æˆ·ç¼©æ”¾ä»¥ä¿æŒåº”ç”¨è´¨æ„Ÿ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ»æ‚£æ²Ÿé€šæ²‰æµ¸å¼å‰§åœºï¼šHIVåœºæ™¯æ¨¡æ‹Ÿ</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #0f172a, #1e1b4b, #312e81);
            --accent-color: #818cf8;
            --highlight-color: #38bdf8;
            --warm-color: #fb7185;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --card-bg: rgba(255, 255, 255, 0.05);
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden; /* é˜²æ­¢æ•´ä½“é¡µé¢æ»šåŠ¨ï¼Œåªå…è®¸å†…éƒ¨æ»šåŠ¨ */
            display: flex;
            flex-direction: column;
        }

        #canvas-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }

        /* --- å¤´éƒ¨é€‚é… --- */
        header {
            position: relative;
            z-index: 10;
            padding: 15px 20px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        h1 { font-size: 1.1rem; font-weight: 500; letter-spacing: 0.5px; margin-bottom: 2px; }
        .subtitle { font-size: 0.75rem; color: var(--text-secondary); }
        
        .mode-badge {
            padding: 4px 10px;
            background: rgba(129, 140, 248, 0.2);
            color: var(--accent-color);
            border-radius: 20px;
            font-size: 0.7rem;
            border: 1px solid rgba(129, 140, 248, 0.3);
            white-space: nowrap;
        }

        /* --- ä¸»èˆå°é€‚é… --- */
        main {
            position: relative;
            z-index: 5;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .theater-stage {
            display: flex;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            justify-content: center;
            flex-direction: row; /* æ¡Œé¢é»˜è®¤æ¨ªå‘ */
            align-items: stretch;
        }

        /* --- å¡ç‰‡è®¾è®¡ --- */
        .scene-card {
            flex: 1;
            background: var(--card-bg);
            border: var(--glass-border);
            border-radius: 16px;
            padding: 25px;
            cursor: pointer;
            transition: transform 0.2s ease, background 0.2s;
            position: relative;
            overflow: hidden;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .scene-card:active { transform: scale(0.98); background: rgba(255, 255, 255, 0.1); }

        .icon-wrapper {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: rgba(255,255,255,0.05);
            width: 70px; height: 70px;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
        }

        .scene-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; color: var(--text-primary); }
        .scene-desc { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; }

        /* --- æ¨¡æ€æ¡† (æ²‰æµ¸å¼å‰§åœº) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active { opacity: 1; pointer-events: all; }

        .theater-container {
            width: 90%; height: 85%; max-width: 1400px;
            display: flex;
            background: #1e1b4b;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255,255,255,0.15);
            flex-direction: row; /* æ¡Œé¢é»˜è®¤æ¨ªå‘ */
        }

        /* å·¦ä¾§ï¼šå¯è§†åŒ–æ¼”ç¤ºåŒº */
        .visual-panel {
            flex: 1.2;
            background: radial-gradient(circle at center, #2e2a5b, #0f172a);
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-right: 1px solid rgba(255,255,255,0.05);
            min-height: 250px;
        }

        /* å³ä¾§ï¼šå‰§æœ¬ä¸ç­–ç•¥åŒº */
        .script-panel {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: rgba(30, 27, 75, 0.95);
            -webkit-overflow-scrolling: touch; /* iOS æƒ¯æ€§æ»šåŠ¨ */
        }

        /* å…³é—­æŒ‰é’®ä¼˜åŒ– */
        .close-btn {
            position: absolute; top: 15px; right: 15px;
            width: 40px; height: 40px;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.2);
            color: white; font-size: 1.5rem; 
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; z-index: 20;
        }

        /* å†…å®¹æ ·å¼ */
        h2 { color: var(--highlight-color); margin-bottom: 15px; font-size: 1.2rem; font-weight: 400; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        
        .dialogue-box {
            background: rgba(255,255,255,0.03);
            border-left: 3px solid var(--accent-color);
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 0 6px 6px 0;
        }
        
        .doctor-line { color: var(--highlight-color); font-weight: bold; font-size: 0.9rem; margin-bottom: 4px; display: block; }
        .patient-line { color: var(--warm-color); font-weight: bold; font-size: 0.9rem; margin-bottom: 4px; display: block; margin-top: 8px; }
        .annotation { font-size: 0.8rem; color: var(--text-secondary); font-style: italic; margin-top: 8px; background: rgba(0,0,0,0.2); padding: 6px; border-radius: 4px; }
        .key-point { display: inline-block; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; background: rgba(56, 189, 248, 0.15); color: var(--highlight-color); margin-right: 5px; margin-bottom: 5px; }

        #animation-canvas { width: 100%; height: 100%; position: relative; display: flex; justify-content: center; align-items: center; }

        /* =========================================
           æ ¸å¿ƒé€‚é…ï¼šåª’ä½“æŸ¥è¯¢ (Media Queries)
           ========================================= */
        
        /* å¹³æ¿å’Œæ‰‹æœº (ç«–å±æ¨¡å¼) */
        @media (max-width: 900px) {
            body { height: auto; min-height: 100vh; overflow-y: auto; } /* å…è®¸bodyæ»šåŠ¨ */
            
            /* 1. ä¸»èˆå°æ”¹ä¸ºçºµå‘å †å  */
            .theater-stage {
                flex-direction: column;
                gap: 15px;
                padding-bottom: 40px;
            }

            .scene-card {
                min-height: auto;
                padding: 20px;
                flex-direction: row; /* å›¾æ ‡åœ¨å·¦ï¼Œæ–‡å­—åœ¨å³ */
                text-align: left;
                align-items: flex-start;
            }

            .icon-wrapper {
                margin-bottom: 0;
                margin-right: 20px;
                width: 50px; height: 50px;
                font-size: 1.8rem;
                flex-shrink: 0;
            }

            /* 2. æ¨¡æ€æ¡†æ”¹ä¸ºä¸Šä¸‹å¸ƒå±€ */
            .theater-container {
                flex-direction: column;
                width: 95%;
                height: 92%;
            }

            .visual-panel {
                flex: 0 0 35%; /* å›ºå®šé«˜åº¦å æ¯”ï¼Œçº¦1/3 */
                border-right: none;
                border-bottom: 1px solid rgba(255,255,255,0.1);
                padding: 10px;
            }

            .script-panel {
                flex: 1; /* å‰©ä½™ç©ºé—´ç»™æ–‡å­— */
                padding: 20px;
            }

            .close-btn {
                top: 10px; right: 10px;
                width: 32px; height: 32px;
                font-size: 1.2rem;
                background: rgba(0,0,0,0.6);
            }
            
            #visual-caption { font-size: 0.8rem; margin-top: 5px; }
        }

        /* å°å±æ‰‹æœºç‰¹åˆ«ä¼˜åŒ– */
        @media (max-width: 480px) {
            h1 { font-size: 1rem; }
            .scene-title { font-size: 1rem; }
            .scene-desc { font-size: 0.8rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
            .visual-panel { flex: 0 0 30%; }
        }
    </style>
</head>
<body>

    <canvas id="canvas-bg"></canvas>

    <header>
        <div>
            <h1>åŒ»æ‚£æ²Ÿé€šå‰§åœº</h1>
            <div class="subtitle">HIV è¯Šç–—ä¸­çš„äººæ–‡ä¸ä¼¦ç†</div>
        </div>
        <div class="mode-badge">ç§»åŠ¨é€‚é…ç‰ˆ</div>
    </header>

    <main>
        <div class="theater-stage">
            <div class="scene-card" onclick="openScene('diagnosis')">
                <div class="icon-wrapper">ğŸ“‹</div>
                <div>
                    <div class="scene-title">ç¬¬ä¸€å¹•ï¼šç¡®è¯Šå‘ŠçŸ¥</div>
                    <div class="scene-desc">è¿ç”¨ SPIKES æ¨¡å‹è¿›è¡Œåæ¶ˆæ¯å‘ŠçŸ¥ï¼Œå¤„ç†æ‚£è€…çš„å¿ƒç†ä¼‘å…‹æœŸã€‚</div>
                </div>
            </div>

            <div class="scene-card" onclick="openScene('adherence')">
                <div class="icon-wrapper">ğŸ’Š</div>
                <div>
                    <div class="scene-title">ç¬¬äºŒå¹•ï¼šä¾ä»æ€§æ•™è‚²</div>
                    <div class="scene-desc">è§£é‡Š U=U æ¦‚å¿µï¼Œè¿ç”¨åŠ¨æœºè®¿è°ˆå»ºç«‹é•¿æœŸæ²»ç–—è”ç›Ÿã€‚</div>
                </div>
            </div>

            <div class="scene-card" onclick="openScene('privacy')">
                <div class="icon-wrapper">ğŸ”’</div>
                <div>
                    <div class="scene-title">ç¬¬ä¸‰å¹•ï¼šéšç§ä¸ä¼¦ç†</div>
                    <div class="scene-desc">åœ¨ä¼´ä¾£å‘ŠçŸ¥ä¸éšç§ä¿æŠ¤ä¹‹é—´å¯»æ‰¾ä¼¦ç†å¹³è¡¡ç‚¹ã€‚</div>
                </div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="modal">
        <div class="theater-container">
            <button class="close-btn" onclick="closeScene()">Ã—</button>
            
            <div class="visual-panel">
                <div id="animation-canvas"></div>
                <div id="visual-caption" style="margin-top: 10px; color: var(--text-secondary); text-align: center; font-size: 0.9rem;"></div>
            </div>

            <div class="script-panel" id="script-content">
                <!-- å†…å®¹ç”± JS åŠ¨æ€æ³¨å…¥ -->
            </div>
        </div>
    </div>

    <script>
        const scenarios = {
            diagnosis: {
                title: "ç¡®è¯Šå‘ŠçŸ¥ï¼šSPIKES æ¨¡å‹",
                content: `
                    <div class="dialogue-box">
                        <span class="key-point">S - Setting (ç¯å¢ƒ)</span>
                        <p><strong>æƒ…å¢ƒï¼š</strong> åŒ»ç”Ÿé€’ä¸Šçº¸å·¾ï¼Œä¿æŒå¹³è§†ã€‚</p>
                        <span class="doctor-line">åŒ»ç”Ÿï¼š</span> â€œåœ¨çœ‹ç»“æœå‰ï¼Œæ‚¨å¯¹è¿™æ¬¡æ£€æµ‹æœ‰ä»€ä¹ˆé¢„æœŸå—ï¼Ÿâ€
                    </div>
                    <div class="dialogue-box">
                        <span class="key-point">K - Knowledge (å‘ŠçŸ¥)</span>
                        <span class="doctor-line">åŒ»ç”Ÿï¼š</span> â€œç»“æœæ˜¾ç¤ºæ˜¯é˜³æ€§ã€‚è¿™æ„å‘³ç€æ‚¨æ„ŸæŸ“äº†HIVã€‚â€
                        <span class="patient-line">æ‚£è€…ï¼š</span> (æ²‰é»˜ï¼Œé¢¤æŠ–)
                        <div class="annotation">ç­–ç•¥ï¼šå‘ŠçŸ¥åå¿…é¡»ç•™ç™½ (Silence)ï¼Œå…è®¸å®£æ³„ã€‚</div>
                    </div>
                    <div class="dialogue-box">
                        <span class="key-point">E - Empathy (å…±æƒ…)</span>
                        <span class="doctor-line">åŒ»ç”Ÿï¼š</span> â€œæˆ‘çŸ¥é“è¿™å¾ˆéš¾æ¥å—ã€‚æ‚¨ç°åœ¨æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿâ€
                        <div class="annotation">ç­–ç•¥ï¼šå‘½åæƒ…ç»ªï¼Œä¸è¦æ€¥äºç»™å»ºè®®ã€‚</div>
                    </div>
                `,
                visualType: "emotion-curve",
                caption: "æ‚£è€…å¿ƒç†ä¼‘å…‹æœŸæƒ…ç»ªæ³¢åŠ¨ (åº“ä¼¯å‹’-ç½—ä¸æ¨¡å‹)"
            },
            adherence: {
                title: "ä¾ä»æ€§ï¼šU=U ä¸æ²»ç–—è”ç›Ÿ",
                content: `
                    <div class="dialogue-box">
                        <span class="key-point">ç§‘å­¦ä¾æ® U=U</span>
                        <span class="doctor-line">åŒ»ç”Ÿï¼š</span> â€œåªè¦æŒ‰æ—¶æœè¯ï¼Œç—…æ¯’æµ‹ä¸åˆ°å°±æ²¡æœ‰ä¼ æŸ“æ€§ã€‚â€
                        <div class="annotation">ç­–ç•¥ï¼šç”¨æ•°æ®æ³¨å…¥å¸Œæœ› (Hope)ã€‚</div>
                    </div>
                    <div class="dialogue-box">
                        <span class="key-point">åŠ¨æœºè®¿è°ˆ (MI)</span>
                        <span class="doctor-line">åŒ»ç”Ÿï¼š</span> â€œæ‚¨è§‰å¾—æ¯å¤©æœè¯æœ€å¤§çš„å›°éš¾æ˜¯ä»€ä¹ˆï¼Ÿâ€
                        <span class="patient-line">æ‚£è€…ï¼š</span> â€œæ€•è¢«åŒäº‹çœ‹åˆ°ã€‚â€
                        <div class="annotation">ç­–ç•¥ï¼šå…±åŒå¯»æ‰¾è§£å†³æ–¹æ¡ˆï¼ˆå¦‚åˆ†è£…è¯ç›’ï¼‰ã€‚</div>
                    </div>
                `,
                visualType: "adherence-chart",
                caption: "ä¾ä»æ€§ä¸ç—…æ¯’è½½é‡/CD4å…³ç³»"
            },
            privacy: {
                title: "éšç§ä¸ä¼¦ç†ï¼šä¼´ä¾£å‘ŠçŸ¥",
                content: `
                    <div class="dialogue-box">
                        <span class="key-point">ä¿å¯†åŸåˆ™</span>
                        <span class="patient-line">æ‚£è€…ï¼š</span> â€œåƒä¸‡åˆ«å‘Šè¯‰æˆ‘å¦»å­ã€‚â€
                        <span class="doctor-line">åŒ»ç”Ÿï¼š</span> â€œæˆ‘æœ‰ä¹‰åŠ¡ä¿æŠ¤æ‚¨çš„éšç§ã€‚â€
                    </div>
                    <div class="dialogue-box">
                        <span class="key-point">ä¼¤å®³é¢„é˜²åŸåˆ™</span>
                        <span class="doctor-line">åŒ»ç”Ÿï¼š</span> â€œä½†å¦‚æœä¸é‡‡å–æªæ–½ï¼Œæ‚¨å¦»å­é¢ä¸´æå¤§é£é™©ã€‚æˆ‘ä»¬éœ€è¦ä¸€èµ·æƒ³åŠæ³•ã€‚â€
                        <div class="annotation">ä¼¦ç†ï¼šé¦–é€‰åŠå¯¼æ‚£è€…è‡ªè¡Œå‘ŠçŸ¥æˆ–ååŠ©å‘ŠçŸ¥ã€‚</div>
                    </div>
                `,
                visualType: "privacy-flow",
                caption: "ä¿¡æ¯æµå‘ä¸ä¼¦ç†å†³ç­–è·¯å¾„"
            }
        };

        const modal = document.getElementById('modal');
        const scriptPanel = document.getElementById('script-content');
        const visualPanel = document.getElementById('animation-canvas');
        const caption = document.getElementById('visual-caption');
        let currentAnimationId = null;
        let activeSceneType = null;

        function openScene(sceneKey) {
            const data = scenarios[sceneKey];
            activeSceneType = data.visualType;
            
            scriptPanel.innerHTML = `<h2>${data.title}</h2>${data.content}`;
            caption.innerText = data.caption;
            modal.classList.add('active');
            
            setTimeout(() => startAnimation(data.visualType), 100);
        }

        function closeScene() {
            modal.classList.remove('active');
            cancelAnimationFrame(currentAnimationId);
            visualPanel.innerHTML = '';
            activeSceneType = null;
        }

        function startAnimation(type) {
            visualPanel.innerHTML = '';
            if (type === 'emotion-curve') renderEmotionCurve();
            else if (type === 'adherence-chart') renderAdherenceChart();
            else if (type === 'privacy-flow') renderPrivacyFlow();
        }

        // --- æ ¸å¿ƒä¿®æ­£ï¼šåŒ»å­¦æƒ…ç»ªæ›²çº¿ç»˜åˆ¶ (å“åº”å¼+Retinaé€‚é…) ---
        function renderEmotionCurve() {
            const rect = visualPanel.getBoundingClientRect();
            let canvas = document.createElement('canvas');
            visualPanel.appendChild(canvas);
            
            // é«˜æ¸…å±é€‚é…
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.style.width = `${rect.width}px`;
            canvas.style.height = `${rect.height}px`;

            const ctx = canvas.getContext('2d');
            ctx.scale(dpr, dpr);

            let time = 0;
            const w = rect.width;
            const h = rect.height;
            const padding = 30;

            function draw() {
                if (!modal.classList.contains('active')) return;
                ctx.clearRect(0, 0, w, h);

                // åæ ‡è½´
                ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding, padding); ctx.lineTo(padding, h - padding);
                ctx.moveTo(padding, h - padding); ctx.lineTo(w - padding, h - padding);
                ctx.stroke();

                ctx.fillStyle = '#94a3b8';
                ctx.font = '10px sans-serif';
                ctx.fillText("å¿ƒç†èƒ½é‡", padding + 5, padding + 10);
                ctx.fillText("æ—¶é—´æ¨ç§»", w - 50, h - padding - 5);

                // æ›²çº¿
                ctx.beginPath();
                ctx.strokeStyle = '#fb7185';
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';

                const graphW = w - padding * 2;
                const graphH = h - padding * 2;

                for (let x = 0; x <= graphW; x += 2) {
                    const progress = x / graphW;
                    let moodValue = 0;

                    // åº“ä¼¯å‹’-ç½—ä¸æ¨¡å‹æ•°å­¦æ¨¡æ‹Ÿ
                    if (progress < 0.15) {
                        moodValue = 0.9 + Math.sin(progress * 20) * 0.02; // ä¼‘å…‹æœŸ
                    } else if (progress < 0.35) {
                        const localP = (progress - 0.15) / 0.20; 
                        moodValue = 0.9 - (localP * 0.5) + Math.sin(x * 0.2 + time * 0.1) * 0.1; // æ„¤æ€’æœŸ
                    } else if (progress < 0.70) {
                        moodValue = 0.3 + Math.sin(x * 0.05) * 0.05; // æŠ‘éƒæœŸ(æœ€ä½ç‚¹)
                    } else {
                        const localP = (progress - 0.70) / 0.30;
                        moodValue = 0.3 + (localP * 0.5); // æ¥å—æœŸ
                    }

                    moodValue = Math.max(0.1, Math.min(0.95, moodValue));
                    const y = (padding) + (1 - moodValue) * graphH;
                    
                    if (x === 0) ctx.moveTo(padding + x, y);
                    else ctx.lineTo(padding + x, y);
                }
                ctx.stroke();

                // æ‰«æçº¿
                const scanProgress = (time * 1.5) % graphW;
                const scanX = padding + scanProgress;
                
                ctx.beginPath();
                ctx.strokeStyle = 'rgba(56, 189, 248, 0.5)';
                ctx.lineWidth = 1;
                ctx.setLineDash([4, 4]);
                ctx.moveTo(scanX, padding);
                ctx.lineTo(scanX, h - padding);
                ctx.stroke();
                ctx.setLineDash([]);

                // åŠ¨æ€æ–‡å­—æ ‡æ³¨
                ctx.fillStyle = '#fff';
                ctx.font = '12px sans-serif';
                let stageText = "";
                const p = scanProgress / graphW;
                if (p < 0.15) stageText = "ä¼‘å…‹æœŸ";
                else if (p < 0.35) stageText = "å¦è®¤/æ„¤æ€’";
                else if (p < 0.70) stageText = "æŠ‘éƒ/ä½è°· (å…±æƒ…ç‚¹)";
                else stageText = "æ¥å—/é‡æ„";
                ctx.fillText(stageText, scanX + 5, padding + 20);

                time += 1;
                currentAnimationId = requestAnimationFrame(draw);
            }
            draw();
        }

        function renderAdherenceChart() {
            const container = document.createElement('div');
            container.style.cssText = "width:100%; height:100%; position:relative; display:flex; justify-content:space-around; align-items:flex-end; padding-bottom:20px;";
            
            const bar1 = document.createElement('div');
            bar1.style.cssText = "width:25%; height:80%; background:#fb7185; border-radius:8px 8px 0 0; position:relative; transition:height 2s; min-width:30px;";
            bar1.innerHTML = "<div style='position:absolute; bottom:-25px; width:100%; text-align:center; color:#aaa; font-size:0.7rem'>ç—…æ¯’</div>";
            
            const bar2 = document.createElement('div');
            bar2.style.cssText = "width:25%; height:20%; background:#38bdf8; border-radius:8px 8px 0 0; position:relative; transition:height 2s; min-width:30px;";
            bar2.innerHTML = "<div style='position:absolute; bottom:-25px; width:100%; text-align:center; color:#aaa; font-size:0.7rem'>CD4</div>";
            
            const pill = document.createElement('div');
            pill.innerHTML = "ğŸ’Š";
            pill.style.cssText = "position:absolute; top:10%; font-size:2rem; animation:dropPill 2s infinite;";
            
            const style = document.createElement('style');
            style.innerHTML = `@keyframes dropPill { 0% { top: 10%; opacity: 0; } 50% { opacity: 1; } 100% { top: 80%; opacity: 0; } }`;
            
            container.appendChild(style);
            container.appendChild(pill);
            container.appendChild(bar1);
            container.appendChild(bar2);
            visualPanel.appendChild(container);

            setTimeout(() => {
                bar1.style.height = "10%";
                bar2.style.height = "70%";
                bar1.style.background = "#aaa";
            }, 500);
        }

        function renderPrivacyFlow() {
            visualPanel.innerHTML = `
                <svg width="100%" height="100%" viewBox="0 0 400 300" preserveAspectRatio="xMidYMid meet">
                    <circle cx="50" cy="150" r="30" fill="#38bdf8" opacity="0.2" />
                    <text x="50" y="155" text-anchor="middle" fill="white" font-size="12">åŒ»ç”Ÿ</text>
                    <circle cx="200" cy="150" r="30" fill="#fb7185" opacity="0.2" />
                    <text x="200" y="155" text-anchor="middle" fill="white" font-size="12">æ‚£è€…</text>
                    <circle cx="350" cy="50" r="25" fill="#94a3b8" opacity="0.1" stroke="#fff" stroke-dasharray="4" />
                    <text x="350" y="55" text-anchor="middle" fill="#aaa" font-size="10">CDC</text>
                    <circle cx="350" cy="250" r="25" fill="#94a3b8" opacity="0.1" stroke="#fff" stroke-dasharray="4" />
                    <text x="350" y="255" text-anchor="middle" fill="#aaa" font-size="10">ä¼´ä¾£</text>
                    <path d="M80 150 L170 150" stroke="#38bdf8" stroke-width="2" marker-end="url(#arrow)" />
                    <path d="M200 120 Q200 50 320 50" stroke="#38bdf8" stroke-width="2" fill="none" stroke-dasharray="5,5" />
                    <path d="M200 180 Q200 250 320 250" stroke="#fb7185" stroke-width="2" fill="none" opacity="0.3" />
                    <circle r="4" fill="#fff"><animateMotion dur="2s" repeatCount="indefinite" path="M80 150 L170 150" /></circle>
                    <text x="260" y="220" fill="#fb7185" font-size="20">ğŸ”’</text>
                    <text x="260" y="80" fill="#38bdf8" font-size="20">âœ…</text>
                    <defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#38bdf8" /></marker></defs>
                </svg>
            `;
        }

        window.addEventListener('resize', () => {
            resizeBg();
            if (activeSceneType && modal.classList.contains('active')) {
                cancelAnimationFrame(currentAnimationId);
                startAnimation(activeSceneType);
            }
        });

        const bgCanvas = document.getElementById('canvas-bg');
        const bgCtx = bgCanvas.getContext('2d');
        let w, h, particles = [];
        function resizeBg() { w = bgCanvas.width = window.innerWidth; h = bgCanvas.height = window.innerHeight; }
        resizeBg();
        class Particle {
            constructor() { this.reset(); }
            reset() { this.x = Math.random()*w; this.y = Math.random()*h; this.vx = (Math.random()-0.5)*0.2; this.vy = (Math.random()-0.5)*0.2; this.size = Math.random()*2; this.alpha = Math.random()*0.5; }
            update() { this.x += this.vx; this.y += this.vy; if(this.x<0) this.x=w; if(this.x>w) this.x=0; if(this.y<0) this.y=h; if(this.y>h) this.y=0; }
            draw() { bgCtx.fillStyle = `rgba(129, 140, 248, ${this.alpha})`; bgCtx.beginPath(); bgCtx.arc(this.x, this.y, this.size, 0, Math.PI*2); bgCtx.fill(); }
        }
        for(let i=0; i<50; i++) particles.push(new Particle());
        function animateBg() { bgCtx.clearRect(0, 0, w, h); particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animateBg); }
        animateBg();

        modal.addEventListener('click', (e) => { if (e.target === modal) closeScene(); });
    </script>
</body>
</html>
